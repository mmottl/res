<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Res by mmottl</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Res</h1>
      <h2 class="project-tagline">OCaml library for resizable arrays and strings</h2>
      <a href="https://github.com/mmottl/res" class="btn">View on GitHub</a>
      <a href="https://github.com/mmottl/res/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/mmottl/res/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="res---automatically-resizing-contiguous-memory-for-ocaml" class="anchor" href="#res---automatically-resizing-contiguous-memory-for-ocaml" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RES - Automatically Resizing Contiguous Memory for OCaml</h1>

<hr>

<h2>
<a id="what-is-res" class="anchor" href="#what-is-res" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is RES?</h2>

<p>This OCaml-library consists of a set of modules which implement automatically
resizing (= reallocating) data structures that consume a contiguous part
of memory.  This allows appending and removing of elements to/from arrays
(both boxed and unboxed), strings (buffers), bit strings and weak arrays
while still maintaining fast constant-time access to elements.</p>

<p>There are also functors that allow the generation of similar modules which
use different reallocation strategies.</p>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>
<p>Fast constant-time access to indexed elements (e.g. in arrays and
strings) is often a prerequisite for short execution times of programs.</p>

<p>Still, operations like adding and/or removing elements to/from the
end of such data structures are often needed.  Unfortunately, having
both properties at the same time sometimes requires reallocating this
contiguous part of memory.</p>

<p>This module does not eliminate this problem, but hides the process of
reallocation from the user, i.e. it happens automatically.</p>

<p>Thus, the user is liberated from this bug-attracting (e.g. index errors)
task.</p>
</li>
<li>
<p>This library allows the user to parameterize allocation strategies at
runtime.  This is an important feature, because it is impossible for
any allocation algorithm to perform optimally without having knowledge
about the user program.</p>

<p>For example, the programmer might know that a consecutive series of
operations will alternately add and remove large batches of elements.
In such a case it would be wise to keep a high reserve of available slots
in the data structure, because otherwise it will resize very often during
this procedure which requires a significant amount of time.</p>

<p>By raising a corresponding threshold in appropriate places at runtime,
programmers can fine-tune the behavior of e.g. their buffers for optimal
performance and set this parameter back later to save memory.</p>
</li>
<li>
<p>Because optimal reallocation strategies may be quite complex,
it was also a design goal to have users supply their own ones (if
required).</p>

<p>By using functors users can parameterize these data structures with
their own reallocation strategies, giving them even more control over
how and when reallocations are triggered.</p>
</li>
<li><p>Users may want to add support for additional low-level implementations
that require reallocations.  In this case, too, it is fairly easy to
create new modules by using functors.</p></li>
<li>
<p>The library implements a large interface of functions, all of which
are completely independent of the reallocation strategy and the low-level
implementation.</p>

<p>All the interfaces of the corresponding low-level implementations of
data structures (e.g. array, string) are fully supported and have been
extended with further functionality.  There is even a new buffer module
which can be used in every context of the standard one.</p>
</li>
<li>
<p>OCaml makes a distinction between unboxed and boxed arrays.  If the type
of an array is <code>float</code>, the representation will be unboxed in cases in
which the array is not used in a polymorphic context (native code only).</p>

<p>To benefit from these much faster representations there are specialized
versions of automatically resizing arrays in the distribution.</p>
</li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>The API is fully documented and can be built as HTML using <code>make doc</code>.
It is also available <a href="http://mmottl.github.io/res/api">online</a>.</p>

<p>The preparameterized modules (default strategy) and the functors for mapping
strategy-implementations to this kind of modules are contained and documented
in file <code>lib/res.mli</code>.</p>

<p>For examples of how to use the functors to implement new strategies and/or
low-level representations, take a look at the implementation in <code>lib/res.ml</code>.</p>

<p>Their function interface, however, is documented in files <code>lib/pres_intf.ml</code>
(for parameterized "low-level" types like e.g. normal arrays) and in
<code>lib/nopres_intf.ml</code> (for non-parameterized "low-level" types like e.g. float
arrays, strings (buffers), etc.).</p>

<h3>
<a id="convenience" class="anchor" href="#convenience" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Convenience</h3>

<p>It should be noted that it is possible to use the standard notation for
accessing elements (e.g. <code>ar.(42)</code>) with resizable arrays (and even with
<code>Buffer</code>, <code>Bits</code>, etc...).  This requires a short explanation of how OCaml
treats such syntactic sugar:</p>

<p>All that OCaml does is that it replaces such syntax with an appropriate
<code>Array.get</code> or <code>Array.set</code>.  This may be <em>any</em> module that happens to be
bound to this name in the current scope.  The same principle is true for the
<code>String</code>-module and the <code>.[]</code>-operator.</p>

<p>Thus, the following works:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">module</span> <span class="pl-en">Array</span> <span class="pl-k">=</span> <span class="pl-c1">Res.</span><span class="pl-en">Bits</span>
<span class="pl-k">module</span> <span class="pl-en">String</span> <span class="pl-k">=</span> <span class="pl-c1">Res.</span><span class="pl-en">Buffer</span>

<span class="pl-k">let</span> <span class="pl-c1">()</span> <span class="pl-k">=</span>
  <span class="pl-k">let</span> ar <span class="pl-k">=</span> <span class="pl-c1">Array.</span>empty <span class="pl-c1">()</span> <span class="pl-k">in</span>
  <span class="pl-c1">Array.</span>add_one ar <span class="pl-c1">true</span>;
  print_endline (string_of_bool ar.(<span class="pl-c1">0</span>));
  <span class="pl-k">let</span> str <span class="pl-k">=</span> <span class="pl-c1">String.</span>empty <span class="pl-c1">()</span> <span class="pl-k">in</span>
  <span class="pl-c1">String.</span>add_one str <span class="pl-c1">'x'</span>;
  print_char str.[<span class="pl-c1">0</span>];
  print_newline <span class="pl-c1">()</span></pre></div>

<p>Do not forget that it is even possible to bind modules locally.  Example:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">let</span> <span class="pl-c1">()</span> <span class="pl-k">=</span>
  <span class="pl-k">let</span> <span class="pl-k">module</span> <span class="pl-c1">Array</span> = <span class="pl-c1">Res.</span><span class="pl-en">Array</span> <span class="pl-k">in</span>
  <span class="pl-c1">Printf.</span>printf <span class="pl-s"><span class="pl-pds">"</span>%d<span class="pl-c1">\n</span><span class="pl-pds">"</span></span> (<span class="pl-c1">Array.</span>init <span class="pl-c1">10</span> (<span class="pl-k">fun</span> <span class="pl-v">x</span> -&gt; x <span class="pl-k">*</span> x)).(<span class="pl-c1">7</span>)</pre></div>

<p>If you want to change one of your files to make use of resizable arrays
instead of standard ones without much trouble, please read the following:</p>

<p>You may want to "save" the standard <code>Array</code>-module and its type for later
access:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">module</span> <span class="pl-en">StdArray</span> <span class="pl-k">=</span> <span class="pl-en">Array</span>
<span class="pl-k">type</span> <span class="pl-k">'a std_array </span>= <span class="pl-k">'a</span> <span class="pl-k">array</span></pre></div>

<p>Make the resizable implementation (includes the index operators!) available:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">open</span> <span class="pl-c1">Res</span></pre></div>

<p>Or more explicitly:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">module</span> <span class="pl-en">Array</span> <span class="pl-k">=</span> <span class="pl-c1">Res.</span><span class="pl-en">Array</span></pre></div>

<p>Or if you want to use a specific <code>Array</code>-implementation:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">module</span> <span class="pl-en">Array</span> <span class="pl-k">=</span> <span class="pl-c1">Res.</span><span class="pl-en">Bits</span></pre></div>

<p>Then set the type:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">type</span> <span class="pl-k">'a array </span>= <span class="pl-k">'a</span> <span class="pl-c1">Array</span><span class="pl-k">.t</span></pre></div>

<p>If you create standard arrays with the built-in syntax, change lines like:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">let</span> ar <span class="pl-k">=</span> [| <span class="pl-c1">1</span>; <span class="pl-c1">2</span>; <span class="pl-c1">3</span>; <span class="pl-c1">4</span> |] <span class="pl-k">in</span></pre></div>

<p>to:</p>

<div class="highlight highlight-source-ocaml"><pre><span class="pl-k">let</span> ar <span class="pl-k">=</span> <span class="pl-c1">Array.</span>of_array [| <span class="pl-c1">1</span>; <span class="pl-c1">2</span>; <span class="pl-c1">3</span>; <span class="pl-c1">4</span> |] <span class="pl-k">in</span></pre></div>

<p>This should allow all of your sources to compile out-of-the-box with the
additional functionality.  In places where you still need the standard
implementation you should have no problems to use the rebound module
and type to do so.</p>

<p>This trick works similarly for the old and the new Buffer-module.  You might
also want to replace the <code>String</code>-module in this fashion.  The latter one,
however, supports a number of functions like e.g. <code>escape</code>, which are not
available then.</p>

<hr>

<h2>
<a id="contact-information-and-contributing" class="anchor" href="#contact-information-and-contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contact Information and Contributing</h2>

<p>In the case of bugs, feature requests, contributions and similar, you can
contact me here: <a href="mailto:markus.mottl@gmail.com">markus.mottl@gmail.com</a></p>

<p>Up-to-date information should be available at: <a href="http://mmottl.github.io/res">http://mmottl.github.io/res</a></p>

<p>Enjoy!</p>

<p>Markus Mottl on July 10, 2012</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/mmottl/res">Res</a> is maintained by <a href="https://github.com/mmottl">mmottl</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
